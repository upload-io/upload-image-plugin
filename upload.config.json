{
  "plugin": {
    "summary": {
      "description": "Resize, crop & convert images.",
      "icon": "ImageResize"
    },
    "parameters": {
      "schema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "additionalProperties": false,
        "definitions": {
          "CompositeStep": {
            "additionalProperties": false,
            "properties": {
              "blend": {
                "enum": [
                  "add",
                  "clear",
                  "color-burn",
                  "color-dodge",
                  "darken",
                  "destination",
                  "destination-atop",
                  "destination-in",
                  "destination-out",
                  "destination-over",
                  "difference",
                  "exclusion",
                  "hard-light",
                  "lighten",
                  "multiply",
                  "overlay",
                  "saturate",
                  "screen",
                  "soft-light",
                  "source",
                  "source-atop",
                  "source-in",
                  "source-out",
                  "source-over",
                  "xor"
                ],
                "type": "string"
              },
              "gravity": {
                "enum": [
                  "center",
                  "east",
                  "north",
                  "northeast",
                  "northwest",
                  "south",
                  "southeast",
                  "southwest",
                  "west"
                ],
                "type": "string"
              },
              "imageFileId": {
                "type": "string"
              },
              "left": {
                "type": "integer"
              },
              "premultiplied": {
                "type": "boolean"
              },
              "tile": {
                "type": "boolean"
              },
              "top": {
                "type": "integer"
              },
              "type": {
                "enum": ["composite"],
                "type": "string"
              }
            },
            "required": ["imageFileId", "type"],
            "type": "object"
          },
          "CropGeometry": {
            "additionalProperties": false,
            "properties": {
              "offset": {
                "$ref": "#/definitions/ImageOffset"
              },
              "size": {
                "$ref": "#/definitions/ImageSizeWidthHeightForce"
              }
            },
            "required": ["offset", "size"],
            "title": "Geometry defining an image crop.",
            "type": "object"
          },
          "CropStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/CropGeometry"
              },
              "type": {
                "enum": ["crop"],
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          },
          "ImageOffset": {
            "additionalProperties": false,
            "properties": {
              "x": {
                "type": "integer"
              },
              "y": {
                "type": "integer"
              }
            },
            "required": ["x", "y"],
            "title": "Pixel offset.",
            "type": "object"
          },
          "ImagePipeline": {
            "additionalProperties": false,
            "properties": {
              "outputFormat": {
                "enum": ["jpg", "png", "webp"],
                "title": "Output format",
                "type": "string"
              },
              "steps": {
                "items": {
                  "anyOf": [
                    {
                      "$ref": "#/definitions/ResizeStep"
                    },
                    {
                      "$ref": "#/definitions/CropStep"
                    },
                    {
                      "$ref": "#/definitions/CompositeStep"
                    }
                  ]
                },
                "title": "Steps",
                "type": "array"
              }
            },
            "required": ["steps"],
            "type": "object"
          },
          "ImagePipelineMergeBehaviour": {
            "additionalProperties": false,
            "properties": {
              "outputFormat": {
                "enum": ["file", "fileThenMaster", "master"],
                "type": "string"
              },
              "steps": {
                "anyOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "mergeBehaviour": {
                        "enum": ["master"],
                        "type": "string"
                      }
                    },
                    "required": ["mergeBehaviour"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "fileWhitelist": {
                        "items": {
                          "enum": ["composite", "crop", "resize"],
                          "type": "string"
                        },
                        "type": "array"
                      },
                      "mergeBehaviour": {
                        "anyOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "removeDuplicates": {
                                "enum": ["end", false, "start"]
                              },
                              "startWith": {
                                "enum": ["file", "master"],
                                "type": "string"
                              }
                            },
                            "required": ["removeDuplicates", "startWith"],
                            "type": "object"
                          },
                          {
                            "enum": ["file"],
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "required": ["fileWhitelist", "mergeBehaviour"],
                    "type": "object"
                  }
                ]
              }
            },
            "required": ["outputFormat", "steps"],
            "type": "object"
          },
          "ImageSizeHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["xheight"],
                "type": "string"
              }
            },
            "required": ["height", "type"],
            "title": "Height given, width automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeWidth": {
            "additionalProperties": false,
            "properties": {
              "type": {
                "enum": ["width"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["type", "width"],
            "title": "Width given, height automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeWidthHeightCover": {
            "additionalProperties": false,
            "properties": {
              "cropStrategy": {
                "anyOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedCenter"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedTop"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedTopLeft"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedTopRight"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedBottom"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedBottomLeft"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedBottomRight"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedLeft"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedRight"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["smartEntropy"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["smartAttention"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  }
                ]
              },
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheightc"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["cropStrategy", "height", "type", "width"],
            "title": "Aspect ratio preserved, image cropped if required. Position dictates cropping strategy.",
            "type": "object"
          },
          "ImageSizeWidthHeightForce": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight!"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Width and height emphatically given, original aspect ratio ignored.",
            "type": "object"
          },
          "ImageSizeWidthHeightMax": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Maximum values of height and width given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeWidthHeightMin": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight^"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Minimum values of width and height given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeWidthHeightShrink": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight>"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Shrinks an image with dimension(s) larger than the corresponding width and/or height argument(s).",
            "type": "object"
          },
          "ResizeGeometry": {
            "additionalProperties": false,
            "description": "\nNote: Some resize modes automatically crop to maintain an aspect ratio without distorting the image.",
            "properties": {
              "size": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/ImageSizeWidth"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightMax"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightMin"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightForce"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightShrink"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightCover"
                  }
                ],
                "title": "Image size."
              }
            },
            "required": ["size"],
            "title": "Geometry defining an image resize.",
            "type": "object"
          },
          "ResizeStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/ResizeGeometry"
              },
              "type": {
                "enum": ["resize"],
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          }
        },
        "properties": {
          "input": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Input path",
            "type": "string"
          },
          "output": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Output path",
            "type": "string"
          },
          "pipeline": {
            "$ref": "#/definitions/ImagePipeline"
          },
          "pipelineMergeBehaviour": {
            "$ref": "#/definitions/ImagePipelineMergeBehaviour"
          }
        },
        "required": ["input", "output", "pipeline"],
        "type": "object"
      },
      "ui": {}
    }
  },
  "templates": {
    "transform": {
      "summary": {
        "name": "Transform an image",
        "description": "Transforms the image into a consistent size and format.",
        "category": "image",
        "icon": "ImageConvert",
        "promoted": true
      },
      "transformation": {
        "description": {
          "ref": "[{if: format != null && (width != null || height != null), then: join('', ['Converts images to \"', to_string(format), '\" and resizes to ', to_string(width || 'ANY'), 'x', to_string(height || 'ANY'), '.'])}, {if: format != null, then: join('', ['Converts images to \"', to_string(format), '\".'])}, {if: width != null || height != null, then: join('', ['Resizes images to ', to_string(width || 'ANY'), 'x', to_string(height || 'ANY'), '.'])}, {if: `true`, then: join('', ['Returns the original image.'])}][?if]|[0].then"
        },
        "scope": {
          "mime": ["*"],
          "tag": ["*"]
        },
        "slug": {
          "ref": "join('', [{if: `true`, then: format || 'original_format'}, {if: width != null, then: [';w=', to_string(width)]}, {if: height != null, then: [';h=', to_string(height)]}][?if].then[])"
        },
        "steps": [
          {
            "plugin": {
              "packageName": "upload-image-plugin",
              "packageVersion": "2.5.4-alpha.3"
            },
            "params": {
              "input": "/",
              "output": "/",
              "pipeline": {
                "outputFormat": {
                  "ref": "format"
                },
                "steps": {
                  "ref": "[[{if: width == null && height == null, then: `[]`}, {if: width != null && height == null, then: to_array({type:'resize',geometry:{size:{type:'width',width:width}}})}, {if: width == null && height != null, then: to_array({type:'resize',geometry:{size:{type:'xheight',height:height}}})}, {if: resizeMode=='Maximum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight',width:width,height:height}}})}, {if: resizeMode=='Minimum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight^',width:width,height:height}}})}, {if: resizeMode=='Exact', then:to_array({type:'resize',geometry:{size:{type:'widthxheight!',width:width,height:height}}})},{if: resizeMode=='Crop', then:to_array({type:'resize',geometry:{size:{type:'widthxheightc',width:width,height:height,cropStrategy:{type: [{if: cropStrategy=='Smart (Vibrancy)', then: 'smartAttention'},{if: cropStrategy=='Smart (Detail)', then: 'smartEntropy'},{if: cropStrategy=='Fixed (Center)', then: 'fixedCenter'},{if: cropStrategy=='Fixed (Left)', then: 'fixedLeft'},{if: cropStrategy=='Fixed (Right)', then: 'fixedRight'},{if: cropStrategy=='Fixed (Top)', then: 'fixedTop'},{if: cropStrategy=='Fixed (Bottom)', then: 'fixedBottom'},{if: cropStrategy=='Fixed (Top Left)', then: 'fixedTopLeft'},{if: cropStrategy=='Fixed (Top Right)', then: 'fixedTopRight'},{if: cropStrategy=='Fixed (Bottom Left)', then: 'fixedBottomLeft'},{if: cropStrategy=='Fixed (Bottom Right)', then: 'fixedBottomRight'}][?if]|[0].then}}}})}][?if]|[0].then,transformationSteps][]"
                }
              }
            }
          }
        ]
      },
      "transformationVariables": {
        "schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "definitions": {
            "CompositeStep": {
              "additionalProperties": false,
              "properties": {
                "blend": {
                  "enum": [
                    "add",
                    "clear",
                    "color-burn",
                    "color-dodge",
                    "darken",
                    "destination",
                    "destination-atop",
                    "destination-in",
                    "destination-out",
                    "destination-over",
                    "difference",
                    "exclusion",
                    "hard-light",
                    "lighten",
                    "multiply",
                    "overlay",
                    "saturate",
                    "screen",
                    "soft-light",
                    "source",
                    "source-atop",
                    "source-in",
                    "source-out",
                    "source-over",
                    "xor"
                  ],
                  "type": "string"
                },
                "gravity": {
                  "enum": [
                    "center",
                    "east",
                    "north",
                    "northeast",
                    "northwest",
                    "south",
                    "southeast",
                    "southwest",
                    "west"
                  ],
                  "type": "string"
                },
                "imageFileId": {
                  "type": "string"
                },
                "left": {
                  "type": "integer"
                },
                "premultiplied": {
                  "type": "boolean"
                },
                "tile": {
                  "type": "boolean"
                },
                "top": {
                  "type": "integer"
                },
                "type": {
                  "enum": ["composite"],
                  "type": "string"
                }
              },
              "required": ["imageFileId", "type"],
              "type": "object"
            }
          },
          "properties": {
            "format": {
              "title": "Output format",
              "type": "string",
              "enum": ["jpg", "png", "webp"],
              "default": "jpg"
            },
            "resizeMode": {
              "title": "Dimensions",
              "type": "string",
              "enum": ["Minimum", "Maximum", "Exact", "Crop"],
              "default": "Maximum"
            },
            "width": {
              "maximum": 10000,
              "minimum": 1,
              "title": "Width",
              "type": "integer",
              "default": 800
            },
            "height": {
              "maximum": 10000,
              "minimum": 1,
              "title": "Height",
              "type": "integer",
              "default": 600
            },
            "transformationSteps": {
              "items": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/CompositeStep"
                  }
                ]
              },
              "title": "Steps",
              "type": "array"
            }
          },
          "required": ["resizeMode"],
          "dependencies": {
            "resizeMode": {
              "oneOf": [
                {
                  "properties": {
                    "resizeMode": {
                      "enum": ["Minimum", "Maximum", "Exact"]
                    }
                  }
                },
                {
                  "properties": {
                    "resizeMode": {
                      "enum": ["Crop"]
                    },
                    "cropStrategy": {
                      "title": "Cropping",
                      "type": "string",
                      "enum": [
                        "Smart (Vibrancy)",
                        "Smart (Detail)",
                        "Fixed (Center)",
                        "Fixed (Left)",
                        "Fixed (Right)",
                        "Fixed (Top)",
                        "Fixed (Bottom)",
                        "Fixed (Top Left)",
                        "Fixed (Top Right)",
                        "Fixed (Bottom Left)",
                        "Fixed (Bottom Right)"
                      ],
                      "default": "Smart (Vibrancy)"
                    }
                  },
                  "required": ["cropStrategy"]
                }
              ]
            }
          }
        },
        "ui": {
          "ui:order": ["format", "resizeMode", "cropStrategy", "width", "height", "transformationSteps"],
          "transformationSteps": {
            "items": {
              "ui:order": ["type", "imageFileId", "gravity", "left", "top", "tile", "blend", "premultiplied"],
              "type": {
                "ui:title": "Transformation Type",
                "composite": {
                  "ui:title": "Add Image Overlay"
                }
              },
              "imageFileId": {
                "ui:title": "Image"
              },
              "blend": {
                "ui:title": "Blend Mode"
              },
              "gravity": {
                "ui:title": "Image Position (Relative)"
              },
              "left": {
                "ui:title": "Image Position (Absolute X)"
              },
              "top": {
                "ui:title": "Image Position (Absolute Y)"
              },
              "tile": {
                "ui:title": "Repeat Image"
              },
              "premultiplied": {
                "ui:title": "Blend Mode: Disable Base Image Premultiplication"
              }
            }
          }
        }
      }
    }
  }
}
