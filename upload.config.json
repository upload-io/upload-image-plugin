{
  "plugin": {
    "summary": {
      "description": "Transcode and resize images.",
      "icon": "ImageResize"
    },
    "parameters": {
      "schema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "additionalProperties": false,
        "definitions": {
          "CropStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/ImageGeometry"
              },
              "type": {
                "enum": ["crop"],
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          },
          "ImageGeometry": {
            "additionalProperties": false,
            "properties": {
              "offset": {
                "$ref": "#/definitions/ImageOffset",
                "title": "Pixel offset."
              },
              "size": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/ImageSizeScale"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeScaleXY"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidth"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightMax"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightMin"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightForce"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightShrink"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightEnlarge"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeArea"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeAspectRatio"
                  }
                ],
                "title": "Image size."
              }
            },
            "required": ["size"],
            "title": "Image size with optional offset.",
            "type": "object"
          },
          "ImageOffset": {
            "additionalProperties": false,
            "properties": {
              "x": {
                "type": "integer"
              },
              "y": {
                "type": "integer"
              }
            },
            "required": ["x", "y"],
            "title": "Pixel offset.",
            "type": "object"
          },
          "ImagePipeline": {
            "additionalProperties": false,
            "properties": {
              "outputFormat": {
                "enum": [
                  "ai",
                  "bmp",
                  "bmp2",
                  "bmp3",
                  "epi",
                  "eps",
                  "gif",
                  "heic",
                  "ico",
                  "jp2",
                  "jpg",
                  "pdf",
                  "pjpeg",
                  "png",
                  "psd",
                  "svg",
                  "tiff",
                  "webp"
                ],
                "title": "Output format",
                "type": "string"
              },
              "steps": {
                "items": {
                  "anyOf": [
                    {
                      "$ref": "#/definitions/ResizeStep"
                    },
                    {
                      "$ref": "#/definitions/CropStep"
                    }
                  ]
                },
                "title": "Steps",
                "type": "array"
              }
            },
            "required": ["steps"],
            "type": "object"
          },
          "ImagePipelineMergeBehaviour": {
            "additionalProperties": false,
            "properties": {
              "outputFormat": {
                "enum": ["file", "fileThenMaster", "master"],
                "type": "string"
              },
              "steps": {
                "anyOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "mergeBehaviour": {
                        "enum": ["master"],
                        "type": "string"
                      }
                    },
                    "required": ["mergeBehaviour"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "fileWhitelist": {
                        "items": {
                          "enum": ["crop", "resize"],
                          "type": "string"
                        },
                        "type": "array"
                      },
                      "mergeBehaviour": {
                        "anyOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "removeDuplicates": {
                                "enum": ["end", false, "start"]
                              },
                              "startWith": {
                                "enum": ["file", "master"],
                                "type": "string"
                              }
                            },
                            "required": ["removeDuplicates", "startWith"],
                            "type": "object"
                          },
                          {
                            "enum": ["file"],
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "required": ["fileWhitelist", "mergeBehaviour"],
                    "type": "object"
                  }
                ]
              }
            },
            "required": ["outputFormat", "steps"],
            "type": "object"
          },
          "ImageSizeArea": {
            "additionalProperties": false,
            "properties": {
              "area": {
                "type": "integer"
              },
              "type": {
                "enum": ["area@"],
                "type": "string"
              }
            },
            "required": ["area", "type"],
            "title": "Resize image to have specified area in pixels. Aspect ratio is preserved.",
            "type": "object"
          },
          "ImageSizeAspectRatio": {
            "additionalProperties": false,
            "properties": {
              "type": {
                "enum": ["x:y"],
                "type": "string"
              },
              "x": {
                "type": "integer"
              },
              "y": {
                "type": "integer"
              }
            },
            "required": ["type", "x", "y"],
            "title": "Aspect ratio (e.g. 3:2 = 1.5).",
            "type": "object"
          },
          "ImageSizeHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["xheight"],
                "type": "string"
              }
            },
            "required": ["height", "type"],
            "title": "Height given, width automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeScale": {
            "additionalProperties": false,
            "properties": {
              "scale": {
                "type": "integer"
              },
              "type": {
                "enum": ["scale%"],
                "type": "string"
              }
            },
            "required": ["scale", "type"],
            "title": "Height and width both scaled by specified percentage.",
            "type": "object"
          },
          "ImageSizeScaleXY": {
            "additionalProperties": false,
            "properties": {
              "scaleX": {
                "type": "integer"
              },
              "scaleY": {
                "type": "integer"
              },
              "type": {
                "enum": ["scale-x%xscale-y%"],
                "type": "string"
              }
            },
            "required": ["scaleX", "scaleY", "type"],
            "title": "Height and width individually scaled by specified percentages.",
            "type": "object"
          },
          "ImageSizeWidth": {
            "additionalProperties": false,
            "properties": {
              "type": {
                "enum": ["width"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["type", "width"],
            "title": "Width given, height automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeWidthHeightEnlarge": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight<"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Enlarges an image with dimension(s) smaller than the corresponding width and/or height argument(s).",
            "type": "object"
          },
          "ImageSizeWidthHeightForce": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight!"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Width and height emphatically given, original aspect ratio ignored.",
            "type": "object"
          },
          "ImageSizeWidthHeightMax": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Maximum values of height and width given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeWidthHeightMin": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight^"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Minimum values of width and height given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeWidthHeightShrink": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight>"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Shrinks an image with dimension(s) larger than the corresponding width and/or height argument(s).",
            "type": "object"
          },
          "ResizeStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/ImageGeometry"
              },
              "type": {
                "enum": ["resize"],
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          }
        },
        "properties": {
          "input": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Input path",
            "type": "string"
          },
          "output": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Output path",
            "type": "string"
          },
          "pipeline": {
            "$ref": "#/definitions/ImagePipeline"
          },
          "pipelineMergeBehaviour": {
            "$ref": "#/definitions/ImagePipelineMergeBehaviour"
          }
        },
        "required": ["input", "output", "pipeline"],
        "type": "object"
      },
      "ui": {}
    }
  },
  "templates": {
    "transform": {
      "summary": {
        "name": "Transform an image",
        "description": "Transforms the image into a consistent size and format.",
        "category": "image",
        "icon": "ImageConvert",
        "promoted": true
      },
      "transformation": {
        "description": {
          "ref": "[{if: format != null && (width != null || height != null), then: join('', ['Converts images to \"', to_string(format), '\" and resizes to ', to_string(width || 'ANY'), 'x', to_string(height || 'ANY'), '.'])}, {if: format != null, then: join('', ['Converts images to \"', to_string(format), '\".'])}, {if: width != null || height != null, then: join('', ['Resizes images to ', to_string(width || 'ANY'), 'x', to_string(height || 'ANY'), '.'])}, {if: `true`, then: join('', ['Returns the original image.'])}][?if]|[0].then"
        },
        "scope": {
          "mime": ["*"],
          "tag": ["*"]
        },
        "slug": {
          "ref": "join('', [{if: `true`, then: format || 'original_format'}, {if: width != null, then: [';w=', to_string(width)]}, {if: height != null, then: [';h=', to_string(height)]}][?if].then[])"
        },
        "steps": [
          {
            "plugin": {
              "packageName": "upload-image-plugin",
              "packageVersion": "1.29.0"
            },
            "params": {
              "input": "/",
              "output": "/",
              "pipeline": {
                "outputFormat": {
                  "ref": "format"
                },
                "steps": {
                  "ref": "[{if: width == null && height == null, then: `[]`}, {if: width != null && height == null, then: to_array({type:'resize',geometry:{size:{type:'width',width:width}}})}, {if: width == null && height != null, then: to_array({type:'resize',geometry:{size:{type:'xheight',height:height}}})}, {if: resizeMode=='Maximum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight',width:width,height:height}}})}, {if: resizeMode=='Minimum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight^',width:width,height:height}}})}, {if: resizeMode=='Exact', then:to_array({type:'resize',geometry:{size:{type:'widthxheight!',width:width,height:height}}})}][?if]|[0].then"
                }
              }
            }
          }
        ]
      },
      "transformationVariables": {
        "schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "properties": {
            "format": {
              "title": "Output format",
              "type": "string",
              "enum": [
                "ai",
                "bmp",
                "bmp2",
                "bmp3",
                "epi",
                "eps",
                "gif",
                "heic",
                "ico",
                "jp2",
                "jpg",
                "pdf",
                "pjpeg",
                "png",
                "psd",
                "svg",
                "tiff",
                "webp"
              ],
              "default": "jpg"
            },
            "resizeMode": {
              "title": "Dimensions",
              "type": "string",
              "enum": ["Minimum", "Maximum", "Exact"],
              "default": "Maximum"
            },
            "width": {
              "maximum": 10000,
              "minimum": 1,
              "title": "Width",
              "type": "integer",
              "default": 800
            },
            "height": {
              "maximum": 10000,
              "minimum": 1,
              "title": "Height",
              "type": "integer",
              "default": 600
            }
          },
          "required": ["resizeMode"]
        },
        "ui": {
          "ui:order": ["format", "resizeMode", "width", "height"]
        }
      }
    }
  }
}
