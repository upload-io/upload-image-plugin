{
  "plugin": {
    "summary": {
      "description": "Resize, crop, transcode and downsample images.",
      "icon": "ImageCrop"
    },
    "parameters": {
      "schema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "additionalProperties": false,
        "definitions": {
          "ImageGeometry": {
            "additionalProperties": false,
            "properties": {
              "offset": {
                "$ref": "#/definitions/ImageOffset",
                "title": "Pixel offset."
              },
              "size": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/ImageSizeScale"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeScaleXY"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidth"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeMinWidthHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeMaxWidthHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightShrink"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightEnlarge"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeArea"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeAspectRatio"
                  }
                ],
                "title": "Image size."
              }
            },
            "required": ["size"],
            "title": "Image size with optional offset.",
            "type": "object"
          },
          "ImageOffset": {
            "additionalProperties": false,
            "properties": {
              "x": {
                "type": "integer"
              },
              "y": {
                "type": "integer"
              }
            },
            "required": ["x", "y"],
            "title": "Pixel offset.",
            "type": "object"
          },
          "ImageSizeArea": {
            "additionalProperties": false,
            "properties": {
              "area": {
                "type": "integer"
              },
              "type": {
                "enum": ["area@"],
                "type": "string"
              }
            },
            "required": ["area", "type"],
            "title": "Resize image to have specified area in pixels. Aspect ratio is preserved.",
            "type": "object"
          },
          "ImageSizeAspectRatio": {
            "additionalProperties": false,
            "properties": {
              "area": {
                "type": "integer"
              },
              "type": {
                "enum": ["x:y"],
                "type": "string"
              },
              "x": {
                "type": "integer"
              },
              "y": {
                "type": "integer"
              }
            },
            "required": ["area", "type", "x", "y"],
            "title": "Aspect ratio (e.g. 3:2 = 1.5).",
            "type": "object"
          },
          "ImageSizeHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["xheight"],
                "type": "string"
              }
            },
            "required": ["height", "type"],
            "title": "Height given, width automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeMaxWidthHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight!"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Maximum values of height and width given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeMinWidthHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight^"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Minimum values of width and height given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeScale": {
            "additionalProperties": false,
            "properties": {
              "scale": {
                "type": "integer"
              },
              "type": {
                "enum": ["scale%"],
                "type": "string"
              }
            },
            "required": ["scale", "type"],
            "title": "Height and width both scaled by specified percentage.",
            "type": "object"
          },
          "ImageSizeScaleXY": {
            "additionalProperties": false,
            "properties": {
              "scaleX": {
                "type": "integer"
              },
              "scaleY": {
                "type": "integer"
              },
              "type": {
                "enum": ["scale-x%xscale-y%"],
                "type": "string"
              }
            },
            "required": ["scaleX", "scaleY", "type"],
            "title": "Height and width individually scaled by specified percentages.",
            "type": "object"
          },
          "ImageSizeWidth": {
            "additionalProperties": false,
            "properties": {
              "type": {
                "enum": ["width"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["type", "width"],
            "title": "Width given, height automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeWidthHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Width and height emphatically given, original aspect ratio ignored.",
            "type": "object"
          },
          "ImageSizeWidthHeightEnlarge": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight<"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Enlarges an image with dimension(s) smaller than the corresponding width and/or height argument(s).",
            "type": "object"
          },
          "ImageSizeWidthHeightShrink": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight>"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Shrinks an image with dimension(s) larger than the corresponding width and/or height argument(s).",
            "type": "object"
          },
          "OutputImageFormat": {
            "enum": [
              "a",
              "aai",
              "ai",
              "art",
              "avs",
              "b",
              "bgr",
              "bgra",
              "bgro",
              "bmp",
              "bmp2",
              "bmp3",
              "c",
              "cal",
              "cals",
              "cin",
              "clip",
              "cmyk",
              "cmyka",
              "cur",
              "data",
              "dcx",
              "dds",
              "dpx",
              "dxt1",
              "dxt5",
              "epdf",
              "epi",
              "eps",
              "epsf",
              "epsi",
              "ept",
              "ept2",
              "ept3",
              "fax",
              "fits",
              "flv",
              "fts",
              "g",
              "g3",
              "g4",
              "gif",
              "gif87",
              "gray",
              "graya",
              "group4",
              "hdr",
              "heic",
              "hrz",
              "icb",
              "ico",
              "icon",
              "inline",
              "ipl",
              "j2c",
              "j2k",
              "jng",
              "jp2",
              "jpc",
              "jpe",
              "jpeg",
              "jpg",
              "jpm",
              "jps",
              "jpt",
              "k",
              "m",
              "m2v",
              "m4v",
              "map",
              "mask",
              "mat",
              "miff",
              "mkv",
              "mng",
              "mono",
              "mov",
              "mp4",
              "mpc",
              "mpeg",
              "mpg",
              "mtv",
              "mvg",
              "null",
              "o",
              "otb",
              "pal",
              "palm",
              "pam",
              "pbm",
              "pcd",
              "pcds",
              "pcl",
              "pct",
              "pcx",
              "pdb",
              "pdf",
              "pdfa",
              "pfm",
              "pgm",
              "pgx",
              "picon",
              "pict",
              "pjpeg",
              "png",
              "png00",
              "png24",
              "png32",
              "png48",
              "png64",
              "png8",
              "pnm",
              "ppm",
              "ps",
              "psb",
              "psd",
              "ptif",
              "r",
              "ras",
              "rgb",
              "rgba",
              "rgbo",
              "rgf",
              "sgi",
              "six",
              "sixel",
              "sun",
              "svg",
              "tga",
              "tiff",
              "tiff64",
              "txt",
              "uyvy",
              "vda",
              "vicar",
              "vid",
              "viff",
              "vips",
              "vst",
              "wbmp",
              "webp",
              "wmv",
              "xbm",
              "xpm",
              "xv",
              "y",
              "ycbcr",
              "ycbcra",
              "yuv"
            ],
            "title": "Supported output image format.",
            "type": "string"
          },
          "ResizeStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/ImageGeometry"
              },
              "type": {
                "enum": ["resize"],
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          }
        },
        "properties": {
          "input": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Input path",
            "type": "string"
          },
          "output": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Output path",
            "type": "string"
          },
          "outputFormat": {
            "$ref": "#/definitions/OutputImageFormat"
          },
          "steps": {
            "items": {
              "$ref": "#/definitions/ResizeStep"
            },
            "minItems": 1,
            "title": "Steps",
            "type": "array"
          }
        },
        "required": ["input", "output", "outputFormat", "steps"],
        "type": "object"
      },
      "ui": {}
    }
  },
  "templates": {
    "transform": {
      "summary": {
        "name": "Transform an image",
        "description": "Transforms the image into consistent size and format.",
        "category": "image",
        "icon": "ImageConvert",
        "promoted": true
      },
      "transformation": {
        "description": {
          "ref": "[{if: format != null && (width != null || height != null), then: join('', ['Converts images to \"', to_string(format), '\" and resizes to ', to_string(width || 'ANY'), 'x', to_string(height || 'ANY'), '.'])}, {if: format != null, then: join('', ['Converts images to \"', to_string(format), '\".'])}, {if: width != null || height != null, then: join('', ['Resizes images to ', to_string(width || 'ANY'), 'x', to_string(height || 'ANY'), '.'])}, {if: `true`, then: join('', ['Resizes images to ', to_string(maxSizeKB), 'KB.'])}][?if]|[0].then"
        },
        "scope": {
          "mime": ["*"],
          "tag": ["*"]
        },
        "slug": {
          "ref": "join('', [{if: `true`, then: format || 'original_format'}, {if: width != null, then: [';w=', to_string(width)]}, {if: height != null, then: [';h=', to_string(height)]}][?if].then[])"
        },
        "steps": [
          {
            "plugin": {
              "packageName": "upload-image-plugin",
              "packageVersion": "1.23.2"
            },
            "params": {
              "input": "/",
              "output": "/",
              "outputFormat": {
                "ref": "format"
              },
              "steps": {
                "ref": "[{if: width == null && height == null, then: `[]`}, {if: width != null && height == null, then: to_array({type:'resize',geometry:{size:{type:'width',width:width}}})}, {if: width == null && height != null, then: to_array({type:'resize',geometry:{size:{type:'xheight',height:height}}})}, {if: resizeMode=='Maximum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight',width:width,height:height}}})}, {if: resizeMode=='Minimum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight^',width:width,height:height}}})}, {if: resizeMode=='Exact', then:to_array({type:'resize',geometry:{size:{type:'widthxheight!',width:width,height:height}}})}][?if]|[0].then"
              }
            },
            "isAsync": false
          }
        ]
      },
      "transformationVariables": {
        "schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "properties": {
            "format": {
              "title": "Output format",
              "type": "string",
              "enum": [
                "a",
                "aai",
                "ai",
                "art",
                "avs",
                "b",
                "bgr",
                "bgra",
                "bgro",
                "bmp",
                "bmp2",
                "bmp3",
                "c",
                "cal",
                "cals",
                "cin",
                "clip",
                "cmyk",
                "cmyka",
                "cur",
                "data",
                "dcx",
                "dds",
                "dpx",
                "dxt1",
                "dxt5",
                "epdf",
                "epi",
                "eps",
                "epsf",
                "epsi",
                "ept",
                "ept2",
                "ept3",
                "fax",
                "fits",
                "flv",
                "fts",
                "g",
                "g3",
                "g4",
                "gif",
                "gif87",
                "gray",
                "graya",
                "group4",
                "hdr",
                "heic",
                "hrz",
                "icb",
                "ico",
                "icon",
                "inline",
                "ipl",
                "j2c",
                "j2k",
                "jng",
                "jp2",
                "jpc",
                "jpe",
                "jpeg",
                "jpg",
                "jpm",
                "jps",
                "jpt",
                "k",
                "m",
                "m2v",
                "m4v",
                "map",
                "mask",
                "mat",
                "miff",
                "mkv",
                "mng",
                "mono",
                "mov",
                "mp4",
                "mpc",
                "mpeg",
                "mpg",
                "mtv",
                "mvg",
                "null",
                "o",
                "otb",
                "pal",
                "palm",
                "pam",
                "pbm",
                "pcd",
                "pcds",
                "pcl",
                "pct",
                "pcx",
                "pdb",
                "pdf",
                "pdfa",
                "pfm",
                "pgm",
                "pgx",
                "picon",
                "pict",
                "pjpeg",
                "png",
                "png00",
                "png24",
                "png32",
                "png48",
                "png64",
                "png8",
                "pnm",
                "ppm",
                "ps",
                "psb",
                "psd",
                "ptif",
                "r",
                "ras",
                "rgb",
                "rgba",
                "rgbo",
                "rgf",
                "sgi",
                "six",
                "sixel",
                "sun",
                "svg",
                "tga",
                "tiff",
                "tiff64",
                "txt",
                "uyvy",
                "vda",
                "vicar",
                "vid",
                "viff",
                "vips",
                "vst",
                "wbmp",
                "webp",
                "wmv",
                "xbm",
                "xpm",
                "xv",
                "y",
                "ycbcr",
                "ycbcra",
                "yuv"
              ],
              "default": "jpg"
            },
            "maxSizeKB": {
              "maximum": 10000,
              "minimum": 5,
              "title": "Desired file size (KB)",
              "type": "integer",
              "default": 50
            },
            "resizeMode": {
              "title": "Dimensions",
              "type": "string",
              "enum": ["Minimum", "Maximum", "Exact"],
              "default": "Maximum"
            },
            "width": {
              "maximum": 10000,
              "minimum": 1,
              "title": "Width",
              "type": "integer",
              "default": 1400
            },
            "height": {
              "maximum": 10000,
              "minimum": 1,
              "title": "Height",
              "type": "integer",
              "default": 1050
            }
          },
          "required": ["resizeMode", "maxSizeKB"]
        },
        "ui": {
          "ui:order": ["format", "maxSizeKB", "resizeMode", "width", "height"]
        }
      }
    }
  }
}
