{
  "plugin": {
    "summary": {
      "description": "Resize, crop & convert images.",
      "icon": "ImageResize"
    },
    "parameters": {
      "schema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "additionalProperties": false,
        "definitions": {
          "BlurStep": {
            "additionalProperties": false,
            "properties": {
              "percentage": {
                "maximum": 100,
                "minimum": 1,
                "title": "Blur Amount",
                "type": "integer"
              },
              "type": {
                "enum": ["blur"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["percentage", "type"],
            "type": "object"
          },
          "CompositeStep": {
            "additionalProperties": false,
            "properties": {
              "blend": {
                "enum": [
                  "add",
                  "clear",
                  "color-burn",
                  "color-dodge",
                  "darken",
                  "destination",
                  "destination-atop",
                  "destination-in",
                  "destination-out",
                  "destination-over",
                  "difference",
                  "exclusion",
                  "hard-light",
                  "lighten",
                  "multiply",
                  "overlay",
                  "saturate",
                  "screen",
                  "soft-light",
                  "source",
                  "source-atop",
                  "source-in",
                  "source-out",
                  "source-over",
                  "xor"
                ],
                "title": "Blend Mode",
                "type": "string"
              },
              "gravity": {
                "enum": [
                  "center",
                  "east",
                  "north",
                  "northeast",
                  "northwest",
                  "south",
                  "southeast",
                  "southwest",
                  "west"
                ],
                "title": "Image Position (Relative)",
                "type": "string"
              },
              "imageFileId": {
                "title": "Image",
                "type": "string"
              },
              "left": {
                "title": "Image Position (Absolute X)",
                "type": "integer"
              },
              "premultiplyBaseImage": {
                "title": "Premultiply Base Image",
                "type": "boolean"
              },
              "tile": {
                "title": "Repeat Image",
                "type": "boolean"
              },
              "top": {
                "title": "Image Position (Absolute Y)",
                "type": "integer"
              },
              "type": {
                "enum": ["composite"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["imageFileId", "type"],
            "type": "object"
          },
          "CropGeometry": {
            "additionalProperties": false,
            "properties": {
              "offset": {
                "$ref": "#/definitions/ImageOffset"
              },
              "size": {
                "$ref": "#/definitions/ImageSizeWidthHeightForce"
              }
            },
            "required": ["offset", "size"],
            "title": "Geometry defining an image crop.",
            "type": "object"
          },
          "CropStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/CropGeometry"
              },
              "type": {
                "enum": ["crop"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          },
          "FlipStep": {
            "additionalProperties": false,
            "properties": {
              "axis": {
                "enum": ["horizontal", "vertical"],
                "title": "Axis",
                "type": "string"
              },
              "type": {
                "enum": ["flip"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["axis", "type"],
            "type": "object"
          },
          "GreyscaleStep": {
            "additionalProperties": false,
            "properties": {
              "type": {
                "enum": ["greyscale"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["type"],
            "type": "object"
          },
          "ImageOffset": {
            "additionalProperties": false,
            "properties": {
              "x": {
                "type": "integer"
              },
              "y": {
                "type": "integer"
              }
            },
            "required": ["x", "y"],
            "title": "Pixel offset.",
            "type": "object"
          },
          "ImagePipeline": {
            "additionalProperties": false,
            "properties": {
              "outputFormat": {
                "anyOf": [
                  {
                    "enum": ["jpg", "png", "webp"],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "title": "Output format"
              },
              "steps": {
                "items": {
                  "anyOf": [
                    {
                      "$ref": "#/definitions/ResizeStep"
                    },
                    {
                      "$ref": "#/definitions/CropStep"
                    },
                    {
                      "$ref": "#/definitions/CompositeStep"
                    },
                    {
                      "$ref": "#/definitions/BlurStep"
                    },
                    {
                      "$ref": "#/definitions/FlipStep"
                    },
                    {
                      "$ref": "#/definitions/GreyscaleStep"
                    },
                    {
                      "$ref": "#/definitions/NegativeStep"
                    }
                  ]
                },
                "title": "Steps",
                "type": "array"
              }
            },
            "required": ["steps"],
            "type": "object"
          },
          "ImagePipelineMergeBehaviour": {
            "additionalProperties": false,
            "properties": {
              "outputFormat": {
                "enum": ["file", "fileThenMaster", "master"],
                "type": "string"
              },
              "steps": {
                "anyOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "mergeBehaviour": {
                        "enum": ["master"],
                        "type": "string"
                      }
                    },
                    "required": ["mergeBehaviour"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "fileWhitelist": {
                        "items": {
                          "enum": ["blur", "composite", "crop", "flip", "greyscale", "negative", "resize"],
                          "type": "string"
                        },
                        "type": "array"
                      },
                      "mergeBehaviour": {
                        "anyOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "removeDuplicates": {
                                "enum": ["end", false, "start"]
                              },
                              "startWith": {
                                "enum": ["file", "master"],
                                "type": "string"
                              }
                            },
                            "required": ["removeDuplicates", "startWith"],
                            "type": "object"
                          },
                          {
                            "enum": ["file"],
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "required": ["fileWhitelist", "mergeBehaviour"],
                    "type": "object"
                  }
                ]
              }
            },
            "required": ["outputFormat", "steps"],
            "type": "object"
          },
          "ImageSizeHeight": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["xheight"],
                "type": "string"
              }
            },
            "required": ["height", "type"],
            "title": "Height given, width automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeWidth": {
            "additionalProperties": false,
            "properties": {
              "type": {
                "enum": ["width"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["type", "width"],
            "title": "Width given, height automagically selected to preserve aspect ratio.",
            "type": "object"
          },
          "ImageSizeWidthHeightCover": {
            "additionalProperties": false,
            "properties": {
              "cropStrategy": {
                "anyOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedCenter"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedTop"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedTopLeft"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedTopRight"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedBottom"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedBottomLeft"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedBottomRight"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedLeft"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["fixedRight"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["smartEntropy"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "type": {
                        "enum": ["smartAttention"],
                        "type": "string"
                      }
                    },
                    "required": ["type"],
                    "type": "object"
                  }
                ]
              },
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheightc"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["cropStrategy", "height", "type", "width"],
            "title": "Aspect ratio preserved, image cropped if required. Position dictates cropping strategy.",
            "type": "object"
          },
          "ImageSizeWidthHeightForce": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight!"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Width and height emphatically given, original aspect ratio ignored.",
            "type": "object"
          },
          "ImageSizeWidthHeightMax": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Maximum values of height and width given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeWidthHeightMin": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight^"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Minimum values of width and height given, aspect ratio preserved.",
            "type": "object"
          },
          "ImageSizeWidthHeightShrink": {
            "additionalProperties": false,
            "properties": {
              "height": {
                "type": "integer"
              },
              "type": {
                "enum": ["widthxheight>"],
                "type": "string"
              },
              "width": {
                "type": "integer"
              }
            },
            "required": ["height", "type", "width"],
            "title": "Shrinks an image with dimension(s) larger than the corresponding width and/or height argument(s).",
            "type": "object"
          },
          "NegativeStep": {
            "additionalProperties": false,
            "properties": {
              "negateAlpha": {
                "title": "Negate Alpha Channel",
                "type": "boolean"
              },
              "type": {
                "enum": ["negative"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["negateAlpha", "type"],
            "type": "object"
          },
          "ResizeGeometry": {
            "additionalProperties": false,
            "description": "\nNote: Some resize modes automatically crop to maintain an aspect ratio without distorting the image.",
            "properties": {
              "size": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/ImageSizeWidth"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeHeight"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightMax"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightMin"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightForce"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightShrink"
                  },
                  {
                    "$ref": "#/definitions/ImageSizeWidthHeightCover"
                  }
                ],
                "title": "Image size."
              }
            },
            "required": ["size"],
            "title": "Geometry defining an image resize.",
            "type": "object"
          },
          "ResizeStep": {
            "additionalProperties": false,
            "properties": {
              "geometry": {
                "$ref": "#/definitions/ResizeGeometry"
              },
              "type": {
                "enum": ["resize"],
                "title": "Transformation Type",
                "type": "string"
              }
            },
            "required": ["geometry", "type"],
            "type": "object"
          }
        },
        "properties": {
          "input": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Input path",
            "type": "string"
          },
          "output": {
            "pattern": "^/(?:((?!\\.*[/\\\\]).)((?![/\\\\]\\.*[/\\\\]).)*)?$",
            "title": "Output path",
            "type": "string"
          },
          "pipeline": {
            "$ref": "#/definitions/ImagePipeline"
          },
          "pipelineMergeBehaviour": {
            "$ref": "#/definitions/ImagePipelineMergeBehaviour"
          }
        },
        "required": ["input", "output", "pipeline"],
        "type": "object"
      },
      "ui": {}
    }
  },
  "templates": {
    "transform": {
      "summary": {
        "name": "Transform an image",
        "description": "Transforms the image into a consistent size and format.",
        "category": "image",
        "icon": "ImageConvert",
        "promoted": true
      },
      "transformation": {
        "description": {
          "ref": "[{if: outputImage.format != 'original' && (outputImage.width != null || outputImage.height != null), then: join('', ['Converts images to \"', to_string(outputImage.format), '\" and resizes to ', to_string(outputImage.width || 'ANY'), 'x', to_string(outputImage.height || 'ANY'), '.'])}, {if: outputImage.format != 'original', then: join('', ['Converts images to \"', to_string(outputImage.format), '\".'])}, {if: outputImage.width != null || outputImage.height != null, then: join('', ['Resizes images to ', to_string(outputImage.width || 'ANY'), 'x', to_string(outputImage.height || 'ANY'), '.'])}, {if: `true`, then: join('', ['Returns the original image.'])}][?if]|[0].then"
        },
        "scope": {
          "mime": ["*"],
          "tag": ["*"]
        },
        "slug": {
          "ref": "join('', [{if: `true`, then: outputImage.format}, {if: outputImage.width != null, then: [';w=', to_string(outputImage.width)]}, {if: outputImage.height != null, then: [';h=', to_string(outputImage.height)]}][?if].then[])"
        },
        "steps": [
          {
            "plugin": {
              "packageName": "upload-image-plugin",
              "packageVersion": "2.5.4-alpha.16"
            },
            "params": {
              "input": "/",
              "output": "/",
              "pipeline": {
                "outputFormat": {
                  "ref": "[{if: outputImage.format != 'original', then: outputImage.format}, {if: `true`, then: null}][?if]|[0].then"
                },
                "steps": {
                  "ref": "[[{if: outputImage.width == null && outputImage.height == null, then: `[]`}, {if: outputImage.width != null && outputImage.height == null, then: to_array({type:'resize',geometry:{size:{type:'width',width:outputImage.width}}})}, {if: outputImage.width == null && outputImage.height != null, then: to_array({type:'resize',geometry:{size:{type:'xheight',height:outputImage.height}}})}, {if: outputImage.resizeMode=='Maximum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight',width:outputImage.width,height:outputImage.height}}})}, {if: outputImage.resizeMode=='Minimum', then:to_array({type:'resize',geometry:{size:{type:'widthxheight^',width:outputImage.width,height:outputImage.height}}})}, {if: outputImage.resizeMode=='Exact', then:to_array({type:'resize',geometry:{size:{type:'widthxheight!',width:outputImage.width,height:outputImage.height}}})},{if: outputImage.resizeMode=='Crop', then:to_array({type:'resize',geometry:{size:{type:'widthxheightc',width:outputImage.width,height:outputImage.height,cropStrategy:{type: [{if: outputImage.cropStrategy=='Smart (Vibrancy)', then: 'smartAttention'},{if: outputImage.cropStrategy=='Smart (Detail)', then: 'smartEntropy'},{if: outputImage.cropStrategy=='Fixed (Center)', then: 'fixedCenter'},{if: outputImage.cropStrategy=='Fixed (Left)', then: 'fixedLeft'},{if: outputImage.cropStrategy=='Fixed (Right)', then: 'fixedRight'},{if: outputImage.cropStrategy=='Fixed (Top)', then: 'fixedTop'},{if: outputImage.cropStrategy=='Fixed (Bottom)', then: 'fixedBottom'},{if: outputImage.cropStrategy=='Fixed (Top Left)', then: 'fixedTopLeft'},{if: outputImage.cropStrategy=='Fixed (Top Right)', then: 'fixedTopRight'},{if: outputImage.cropStrategy=='Fixed (Bottom Left)', then: 'fixedBottomLeft'},{if: outputImage.cropStrategy=='Fixed (Bottom Right)', then: 'fixedBottomRight'}][?if]|[0].then}}}})}][?if]|[0].then,transformationSteps][]"
                }
              }
            }
          }
        ]
      },
      "transformationVariables": {
        "schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "definitions": {
            "BlurStep": {
              "additionalProperties": false,
              "properties": {
                "percentage": {
                  "maximum": 100,
                  "minimum": 1,
                  "title": "Blur Amount",
                  "type": "integer",
                  "default": 20
                },
                "type": {
                  "enum": ["blur"],
                  "title": "Transformation Type",
                  "type": "string"
                }
              },
              "required": ["percentage", "type"],
              "type": "object"
            },
            "CompositeStep": {
              "additionalProperties": false,
              "properties": {
                "blend": {
                  "enum": [
                    "add",
                    "clear",
                    "color-burn",
                    "color-dodge",
                    "darken",
                    "destination",
                    "destination-atop",
                    "destination-in",
                    "destination-out",
                    "destination-over",
                    "difference",
                    "exclusion",
                    "hard-light",
                    "lighten",
                    "multiply",
                    "overlay",
                    "saturate",
                    "screen",
                    "soft-light",
                    "source",
                    "source-atop",
                    "source-in",
                    "source-out",
                    "source-over",
                    "xor"
                  ],
                  "title": "Blend Mode",
                  "type": "string",
                  "default": "source-over"
                },
                "gravity": {
                  "enum": [
                    "center",
                    "east",
                    "north",
                    "northeast",
                    "northwest",
                    "south",
                    "southeast",
                    "southwest",
                    "west"
                  ],
                  "title": "Image Position (Auto)",
                  "type": "string",
                  "default": "center"
                },
                "imageFileId": {
                  "title": "Image Source",
                  "type": "string"
                },
                "left": {
                  "title": "Image Position (X)",
                  "type": "integer"
                },
                "premultiplyBaseImage": {
                  "title": "Premultiply Base Image",
                  "type": "boolean",
                  "default": true
                },
                "tile": {
                  "title": "Repeat Image",
                  "type": "boolean",
                  "default": false
                },
                "top": {
                  "title": "Image Position (Y)",
                  "type": "integer"
                },
                "type": {
                  "enum": ["composite"],
                  "title": "Transformation Type",
                  "type": "string"
                }
              },
              "required": ["imageFileId", "type", "gravity", "blend", "tile", "premultiplyBaseImage"],
              "type": "object"
            },
            "FlipStep": {
              "additionalProperties": false,
              "properties": {
                "axis": {
                  "enum": ["horizontal", "vertical"],
                  "title": "Axis",
                  "type": "string",
                  "default": "horizontal"
                },
                "type": {
                  "enum": ["flip"],
                  "title": "Transformation Type",
                  "type": "string"
                }
              },
              "required": ["axis", "type"],
              "type": "object"
            },
            "GreyscaleStep": {
              "additionalProperties": false,
              "properties": {
                "type": {
                  "enum": ["greyscale"],
                  "title": "Transformation Type",
                  "type": "string"
                }
              },
              "required": ["type"],
              "type": "object"
            },
            "NegativeStep": {
              "additionalProperties": false,
              "properties": {
                "negateAlpha": {
                  "title": "Negative Alpha Channel",
                  "type": "boolean",
                  "default": false
                },
                "type": {
                  "enum": ["negative"],
                  "title": "Transformation Type",
                  "type": "string"
                }
              },
              "required": ["negateAlpha", "type"],
              "type": "object"
            }
          },
          "properties": {
            "outputImage": {
              "type": "object",
              "title": "Output Image",
              "required": ["resizeMode", "format"],
              "dependencies": {
                "resizeMode": {
                  "oneOf": [
                    {
                      "properties": {
                        "resizeMode": {
                          "enum": ["Minimum", "Maximum", "Exact"]
                        }
                      }
                    },
                    {
                      "properties": {
                        "resizeMode": {
                          "enum": ["Crop"]
                        },
                        "cropStrategy": {
                          "title": "Crop Mode",
                          "type": "string",
                          "enum": [
                            "Smart (Vibrancy)",
                            "Smart (Detail)",
                            "Fixed (Center)",
                            "Fixed (Left)",
                            "Fixed (Right)",
                            "Fixed (Top)",
                            "Fixed (Bottom)",
                            "Fixed (Top Left)",
                            "Fixed (Top Right)",
                            "Fixed (Bottom Left)",
                            "Fixed (Bottom Right)"
                          ],
                          "default": "Smart (Vibrancy)"
                        }
                      },
                      "required": ["cropStrategy"]
                    }
                  ]
                }
              },
              "properties": {
                "format": {
                  "title": "Format",
                  "type": "string",
                  "enum": ["original", "jpg", "png", "webp"],
                  "default": "jpg"
                },
                "resizeMode": {
                  "title": "Resize Mode",
                  "type": "string",
                  "enum": ["Minimum", "Maximum", "Exact", "Crop"],
                  "default": "Maximum"
                },
                "width": {
                  "maximum": 10000,
                  "minimum": 1,
                  "title": "Width",
                  "type": "integer",
                  "default": 800
                },
                "height": {
                  "maximum": 10000,
                  "minimum": 1,
                  "title": "Height",
                  "type": "integer",
                  "default": 600
                }
              }
            },
            "transformationSteps": {
              "items": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/BlurStep"
                  },
                  {
                    "$ref": "#/definitions/CompositeStep"
                  },
                  {
                    "$ref": "#/definitions/FlipStep"
                  },
                  {
                    "$ref": "#/definitions/GreyscaleStep"
                  },
                  {
                    "$ref": "#/definitions/NegativeStep"
                  }
                ]
              },
              "title": "Transformation Steps",
              "type": "array"
            }
          },
          "required": ["outputImage"]
        },
        "ui": {
          "ui:order": ["outputImage", "transformationSteps"],
          "outputImage": {
            "ui:order": ["format", "width", "height", "resizeMode", "cropStrategy"],
            "format": {
              "original": {
                "ui:title": "Original Format"
              },
              "jpg": {
                "ui:title": "JPG"
              },
              "png": {
                "ui:title": "PNG"
              },
              "webp": {
                "ui:title": "WebP"
              }
            }
          },
          "transformationSteps": {
            "items": {
              "ui:order": [
                "type",
                "imageFileId",
                "gravity",
                "left",
                "top",
                "tile",
                "blend",
                "premultiplyBaseImage",
                "percentage",
                "axis",
                "negateAlpha"
              ],
              "percentage": {
                "ui:widget": "range"
              },
              "axis": {
                "ui:options:labels:transform": "propercase"
              },
              "gravity": {
                "ui:options:labels:transform": "propercase"
              },
              "blend": {
                "ui:options:labels:transform": "propercase"
              },
              "type": {
                "composite": {
                  "ui:title": "Overlay"
                }
              }
            }
          }
        }
      }
    }
  }
}
